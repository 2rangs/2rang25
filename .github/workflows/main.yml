- name: Deploy to EC2
  uses: appleboy/ssh-action@master
  with:
    host: ${{ secrets.HOST }}
    username: ${{ secrets.USER }}
    key: ${{ secrets.SSH_PRIVATE_KEY }}
    script: |
      set -e  # 에러 발생 시 중단
      
      # Node.js 설치 및 버전 고정
      curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
      sudo apt-get install -y nodejs
      node -v  # Node.js 버전 확인
      npm -v   # npm 버전 확인
      
      # 프로젝트 업데이트 및 빌드
      cd 2rang25
      git reset --hard
      git pull origin main
      export NUXT_UI_PRO_LICENSE=${{ secrets.NUXT_UI_PRO_LICENSE }}
      npm install
      npm run build || exit 1
      
      # PM2 재시작
      pm2 delete all || true
      pm2 start ecosystem.config.cjs
      
      # PM2 상태 확인
      echo "==== PM2 STATUS ===="
      pm2 status
